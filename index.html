<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Tutor Dashboard - Interactive Demo</title>
  <style>
    /* ==================== BASE STYLES ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    /* ==================== DEMO BANNER ==================== */
    .demo-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #ff6b6b;
      color: white;
      padding: 12px;
      text-align: center;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .demo-banner a {
      color: white;
      text-decoration: underline;
      margin-left: 10px;
    }

    /* ==================== LOGIN SCREEN ==================== */
    #loginOverlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }

    .login-box {
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 450px;
      width: 100%;
    }

    .login-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #2d3748;
    }

    .login-subtitle {
      font-size: 14px;
      color: #718096;
      margin-bottom: 32px;
    }

    .demo-credentials {
      background: #f7fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .demo-credentials-title {
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .credential-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .credential-option:last-child {
      border-bottom: none;
    }

    .credential-role {
      font-weight: 500;
      color: #4a5568;
      font-size: 14px;
    }

    .credential-id {
      font-family: 'Courier New', monospace;
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 13px;
      color: #667eea;
      cursor: pointer;
      transition: all 0.2s;
    }

    .credential-id:hover {
      background: #667eea;
      color: white;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .input-field {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.2s;
    }

    .input-field:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    .login-error {
      background: #fed7d7;
      color: #c53030;
      padding: 12px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 14px;
      display: none;
    }

    /* ==================== LOADING OVERLAY ==================== */
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      flex-direction: column;
    }

    #loadingOverlay.show {
      display: flex;
    }

    .penguin-container {
      width: 200px;
      height: 200px;
      margin-bottom: 24px;
    }

    .penguin {
      width: 100%;
      height: 100%;
      background-image: url('https://i.imgur.com/zKBRT3r.gif');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    .loading-text {
      color: white;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      text-align: center;
    }

    .loading-subtext {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      text-align: center;
    }

    .progress-messages {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 60px;
    }

    .progress-message {
      color: white;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: 0;
      transform: translateX(-20px);
      animation: slideIn 0.3s forwards;
    }

    @keyframes slideIn {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .progress-message.complete::before {
      content: '‚úì';
      color: #48bb78;
      font-weight: 700;
    }

    /* ==================== MAIN APP ==================== */
    #app {
      width: 100%;
      max-width: 1400px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      display: none;
      margin-top: 50px;
      position: relative;
    }

    /* ==================== API PANEL ==================== */
    .api-panel-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: all 0.2s;
    }

    .api-panel-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
    }

    .api-panel {
      position: fixed;
      right: -500px;
      top: 70px;
      bottom: 20px;
      width: 480px;
      background: #1a202c;
      border-radius: 12px 0 0 12px;
      box-shadow: -4px 0 20px rgba(0,0,0,0.3);
      transition: right 0.3s;
      z-index: 999;
      display: flex;
      flex-direction: column;
    }

    .api-panel.show {
      right: 0;
    }

    .api-panel-header {
      background: #2d3748;
      padding: 16px 20px;
      color: white;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .api-panel-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .api-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .api-request {
      background: #2d3748;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .api-request-title {
      color: #48bb78;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 8px;
      font-family: 'Courier New', monospace;
    }

    .api-request-time {
      color: #a0aec0;
      font-size: 12px;
      margin-bottom: 12px;
    }

    .api-code {
      background: #1a202c;
      border-radius: 4px;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #e2e8f0;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* ==================== HEADER ==================== */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
    }

    .search-container {
      flex: 1;
      max-width: 500px;
      margin: 0 32px;
    }

    .search-input {
      width: 100%;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      background: rgba(255,255,255,0.9);
    }

    .search-input:focus {
      outline: none;
      background: white;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logout-btn {
      padding: 8px 16px;
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    /* ==================== CONTAINER ==================== */
    .container {
      padding: 32px;
    }

    /* ==================== STUDENT LIST ==================== */
    .student-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .student-card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .student-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .student-avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .student-card-content {
      flex: 1;
      min-width: 0;
    }

    .student-name {
      font-size: 18px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 4px;
    }

    .student-meta {
      font-size: 14px;
      color: #718096;
    }

    /* ==================== PROFILE VIEW ==================== */
    .profile-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 24px;
    }

    .back-btn {
      padding: 10px 20px;
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: #e2e8f0;
    }

    .profile-title {
      font-size: 28px;
      font-weight: 700;
      color: #2d3748;
    }

    .profile-meta {
      font-size: 14px;
      color: #718096;
      margin-top: 4px;
    }

    /* ==================== TABS ==================== */
    .tabs {
      display: flex;
      gap: 8px;
      border-bottom: 2px solid #e2e8f0;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #718096;
      transition: all 0.2s;
      margin-bottom: -2px;
    }

    .tab-btn:hover {
      color: #667eea;
    }

    .tab-btn.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* ==================== CARD ==================== */
    .card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-section {
      margin-bottom: 16px;
    }

    .card-section:last-child {
      margin-bottom: 0;
    }

    .card-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #a0aec0;
      margin-bottom: 4px;
      letter-spacing: 0.5px;
    }

    .card-value {
      font-size: 15px;
      color: #2d3748;
      line-height: 1.6;
    }

    .card-value a {
      color: #667eea;
      text-decoration: none;
    }

    .card-value a:hover {
      text-decoration: underline;
    }

    /* ==================== TUTORS GRID ==================== */
    .tutors-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .tutor-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .tutor-chip:hover {
      background: #667eea;
      border-color: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    .tutor-chip:hover .tutor-tooltip {
      opacity: 1;
      visibility: visible;
    }

    .tutor-name {
      font-weight: 600;
      font-size: 14px;
    }

    .tutor-subject {
      font-size: 13px;
      color: #718096;
    }

    .tutor-chip:hover .tutor-subject {
      color: rgba(255,255,255,0.8);
    }

    .tutor-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #2d3748;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      margin-bottom: 8px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
      pointer-events: none;
      z-index: 100;
    }

    .tutor-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: #2d3748;
    }

    /* ==================== COMMENTS ==================== */
    .persistent-comments-section {
      margin-top: 32px;
    }

    .load-comments-btn {
      width: 100%;
      padding: 14px;
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      transition: all 0.2s;
      margin-bottom: 16px;
    }

    .load-comments-btn:hover {
      background: #e2e8f0;
      border-color: #cbd5e0;
    }

    .comments-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .comment {
      background: #f7fafc;
      border-left: 4px solid #667eea;
      border-radius: 8px;
      padding: 16px;
    }

    .comment-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .comment-author {
      font-weight: 600;
      color: #667eea;
      cursor: pointer;
      position: relative;
    }

    .comment-author:hover {
      text-decoration: underline;
    }

    .comment-date {
      font-size: 13px;
      color: #a0aec0;
    }

    .comment-body {
      color: #2d3748;
      line-height: 1.6;
      font-size: 15px;
    }

    .comment-body a {
      color: #667eea;
      text-decoration: none;
    }

    .comment-body a:hover {
      text-decoration: underline;
    }

    /* ==================== HISTORY ==================== */
    .history-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .history-item {
      background: #f7fafc;
      border-radius: 8px;
      padding: 16px;
      border-left: 4px solid #48bb78;
      cursor: pointer;
      transition: all 0.2s;
    }

    .history-item:hover {
      background: #edf2f7;
      transform: translateX(4px);
    }

    .history-date {
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .history-subject {
      color: #718096;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .history-tutor {
      color: #48bb78;
      font-size: 13px;
      font-weight: 600;
    }

    .history-notes {
      margin-top: 8px;
      color: #4a5568;
      font-size: 13px;
    }

    .load-more-btn {
      width: 100%;
      padding: 12px;
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      transition: all 0.2s;
      margin-top: 12px;
    }

    .load-more-btn:hover {
      background: #e2e8f0;
    }

    /* ==================== MODAL ==================== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: 16px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: all 0.2s;
      position: relative;
    }

    .modal-overlay.show .modal {
      transform: scale(1);
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 24px;
    }

    .modal-section {
      margin-bottom: 20px;
    }

    .modal-section:last-child {
      margin-bottom: 0;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #a0aec0;
      padding: 4px;
      line-height: 1;
    }

    .modal-close:hover {
      color: #2d3748;
    }

    /* ==================== UTILITIES ==================== */
    .hidden {
      display: none !important;
    }

    .empty-state {
      text-align: center;
      color: #a0aec0;
      padding: 40px;
      font-style: italic;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
      .student-list {
        grid-template-columns: 1fr;
      }

      .search-container {
        margin: 0 16px;
      }

      .tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .tab-btn {
        white-space: nowrap;
      }

      .api-panel {
        width: 100%;
        right: -100%;
      }

      .api-panel-toggle {
        bottom: 10px;
        right: 10px;
        padding: 10px 16px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Demo Banner -->
  <div class="demo-banner">
    üéØ Interactive Demo - Full Source Code on <a href="https://github.com/yourusername/tutor-dashboard" target="_blank">GitHub</a> | Click API Panel to see JSON responses
  </div>

  <!-- Login Screen -->
  <div id="loginOverlay">
    <div class="login-box">
      <div class="login-title">Student Tutor Dashboard</div>
      <div class="login-subtitle">Sign in to view your students</div>
      
      <div class="demo-credentials">
        <div class="demo-credentials-title">üé¨ Demo Credentials (Click to Use)</div>
        <div class="credential-option">
          <span class="credential-role">Admin (sees all 7 students)</span>
          <span class="credential-id" onclick="fillLogin('16180339')">16180339</span>
        </div>
        <div class="credential-option">
          <span class="credential-role">Math Tutor (5 students)</span>
          <span class="credential-id" onclick="fillLogin('98765')">98765</span>
        </div>
        <div class="credential-option">
          <span class="credential-role">Reading Tutor (4 students)</span>
          <span class="credential-id" onclick="fillLogin('87654')">87654</span>
        </div>
        <div class="credential-option">
          <span class="credential-role">Science Tutor (3 students)</span>
          <span class="credential-id" onclick="fillLogin('76543')">76543</span>
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Employee ID</label>
        <input type="text" id="empIdInput" class="input-field" placeholder="Enter your Employee ID">
      </div>

      <button class="login-btn" onclick="login()">Sign In</button>
      <div class="login-error" id="loginError"></div>
    </div>
  </div>

  <!-- Loading Overlay with Penguin -->
  <div id="loadingOverlay">
    <div class="penguin-container">
      <div class="penguin"></div>
    </div>
    <div class="loading-text" id="loadingText">Loading Dashboard...</div>
    <div class="loading-subtext" id="loadingSubtext">Caching data for optimal performance</div>
    <div class="progress-messages" id="progressMessages"></div>
  </div>

  <!-- Main App -->
  <div id="app">
    <!-- Header -->
    <div class="header">
      <div class="logo" onclick="showList()">üìö STD</div>
      <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search students..." oninput="filterStudents()">
      </div>
      <div class="user-menu">
        <span id="userName">User</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- Student List View -->
    <div id="listView" class="container">
      <div class="student-list" id="studentList"></div>
    </div>

    <!-- Profile View -->
    <div id="profileView" class="container hidden">
      <div class="profile-header">
        <button class="back-btn" onclick="showList()">‚Üê Back</button>
        <div>
          <div class="profile-title" id="profileTitle">Student Profile</div>
          <div class="profile-meta" id="profileMeta"></div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="overview" onclick="switchTab('overview')">Overview</button>
        <button class="tab-btn" data-tab="team" onclick="switchTab('team')">Team</button>
        <button class="tab-btn" data-tab="contact" onclick="switchTab('contact')">Contact</button>
        <button class="tab-btn" data-tab="history" onclick="switchTab('history')">History</button>
      </div>

      <!-- Overview Tab -->
      <div id="overviewTab" class="tab-content active">
        <div class="card">
          <div class="card-title">Student Information</div>
          <div class="card-section">
            <div class="card-label">Bio</div>
            <div class="card-value" id="studentBio"></div>
          </div>
          <div class="card-section">
            <div class="card-label">Additional Notes</div>
            <div class="card-value" id="studentNotes"></div>
          </div>
        </div>
      </div>

      <!-- Team Tab -->
      <div id="teamTab" class="tab-content">
        <div class="card">
          <div class="card-title">Tutors Working with This Student</div>
          <div class="tutors-grid" id="tutorsList"></div>
        </div>
      </div>

      <!-- Contact Tab -->
      <div id="contactTab" class="tab-content">
        <div class="card">
          <div class="card-title">Contact Information</div>
          <div class="card-section">
            <div class="card-label">Student Email</div>
            <div class="card-value" id="contactEmail"></div>
          </div>
          <div class="card-section">
            <div class="card-label">Student Phone</div>
            <div class="card-value" id="contactPhone"></div>
          </div>
          <div class="card-section">
            <div class="card-label">Parent/Guardian</div>
            <div class="card-value" id="contactParent"></div>
          </div>
          <div class="card-section">
            <div class="card-label">Parent Email</div>
            <div class="card-value" id="contactParentEmail"></div>
          </div>
          <div class="card-section">
            <div class="card-label">Parent Phone</div>
            <div class="card-value" id="contactParentPhone"></div>
          </div>
        </div>
      </div>

      <!-- History Tab -->
      <div id="historyTab" class="tab-content">
        <div class="card">
          <div class="card-title">Session History</div>
          <div class="history-list" id="historyList"></div>
          <button class="load-more-btn hidden" id="loadMoreBtn" onclick="loadMoreHistory()">Load More Sessions</button>
        </div>
      </div>

      <!-- Persistent Comments Section (visible under all tabs) -->
      <div class="persistent-comments-section">
        <button class="load-comments-btn" id="loadCommentsBtn" onclick="loadComments()">Load Comments</button>
        
        <div class="card hidden" id="commentsCard">
          <div class="card-title">Team Comments</div>
          <div class="comments-section" id="commentsList"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tutor Info Modal -->
  <div id="tutorModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeTutorModal()">√ó</button>
      <div class="modal-title" id="tutorModalName"></div>
      <div class="modal-section">
        <div class="card-label">Email</div>
        <div class="card-value" id="tutorModalEmail"></div>
      </div>
      <div class="modal-section">
        <div class="card-label">Phone (Mobile)</div>
        <div class="card-value" id="tutorModalMobile"></div>
      </div>
      <div class="modal-section">
        <div class="card-label">Phone (Home)</div>
        <div class="card-value" id="tutorModalHome"></div>
      </div>
      <div class="modal-section">
        <div class="card-label">Subjects</div>
        <div class="card-value" id="tutorModalSubjects"></div>
      </div>
    </div>
  </div>

  <!-- API Response Panel -->
  <button class="api-panel-toggle" onclick="toggleApiPanel()">üì° View API Responses</button>
  <div class="api-panel" id="apiPanel">
    <div class="api-panel-header">
      <span>Live API Responses</span>
      <button class="api-panel-close" onclick="toggleApiPanel()">√ó</button>
    </div>
    <div class="api-panel-content" id="apiPanelContent">
      <div style="color: #a0aec0; text-align: center; padding: 40px;">
        No API calls yet. Interact with the dashboard to see JSON responses!
      </div>
    </div>
  </div>

  <script>
    /*
     * ==================== GLOBAL STATE ====================
     * This section manages application state and cached data
     */
    
    // User state
    let currentUser = null;
    let currentStudent = null;
    
    // Cached data (preloaded on login for performance)
    let cachedTutors = {};
    let cachedStudents = [];
    let cachedLinks = [];
    
    // Session history pagination
    let historyOffset = 0;
    const HISTORY_PAGE_SIZE = 3;
    
    // API request log for demo panel
    let apiRequests = [];

    /*
     * ==================== MOCK API ====================
     * Simulates backend API with realistic delays and JSON responses
     * In production, these would be actual HTTP requests to Apps Script backend
     */
    
    async function mockApiCall(endpoint, delay = 500) {
      // Simulate network delay
      await new Promise(resolve => setTimeout(resolve, delay));
      
      // Log API call for demo panel
      const timestamp = new Date().toLocaleTimeString();
      let responseData = null;
      
      switch(endpoint) {
        case 'tutors':
          responseData = await fetch('./data/tutors.json').then(r => r.json());
          break;
        case 'students':
          responseData = await fetch('./data/students.json').then(r => r.json());
          break;
        case 'links':
          responseData = await fetch('./data/links.json').then(r => r.json());
          break;
        case 'comments':
          responseData = await fetch('./data/comments.json').then(r => r.json());
          break;
        case 'sessions':
          responseData = await fetch('./data/sessions.json').then(r => r.json());
          break;
      }
      
      // Log to API panel
      logApiRequest(endpoint, timestamp, responseData);
      
      return responseData;
    }
    
    function logApiRequest(endpoint, timestamp, data) {
      const request = {
        endpoint,
        timestamp,
        data: JSON.stringify(data, null, 2).substring(0, 500) + '...' // Truncate for display
      };
      
      apiRequests.unshift(request);
      if (apiRequests.length > 10) apiRequests.pop(); // Keep last 10
      
      updateApiPanel();
    }
    
    function updateApiPanel() {
      const content = document.getElementById('apiPanelContent');
      
      if (apiRequests.length === 0) {
        content.innerHTML = '<div style="color: #a0aec0; text-align: center; padding: 40px;">No API calls yet. Interact with the dashboard to see JSON responses!</div>';
        return;
      }
      
      content.innerHTML = apiRequests.map(req => `
        <div class="api-request">
          <div class="api-request-title">GET /api/${req.endpoint}</div>
          <div class="api-request-time">${req.timestamp}</div>
          <div class="api-code">${escapeHtml(req.data)}</div>
        </div>
      `).join('');
    }
    
    function toggleApiPanel() {
      document.getElementById('apiPanel').classList.toggle('show');
    }

    /*
     * ==================== AUTH & LOGIN ====================
     * Handles user authentication and initial data preloading
     */
    
    function fillLogin(empId) {
      document.getElementById('empIdInput').value = empId;
    }

    async function login() {
      const empId = document.getElementById('empIdInput').value.trim();
      const errorEl = document.getElementById('loginError');

      if (!empId) {
        errorEl.textContent = 'Please enter an Employee ID';
        errorEl.style.display = 'block';
        return;
      }

      // Show loading overlay with penguin
      showLoading();
      
      // Simulate login API call
      await mockApiCall('login', 300);
      
      // Load tutors data
      showProgressMessage('Loading tutors directory...');
      const tutors = await mockApiCall('tutors', 800);
      
      // Convert to map for fast lookup
      cachedTutors = {};
      tutors.forEach(t => {
        cachedTutors[t.id] = t;
      });
      showProgressMessage('‚úì Tutors loaded', true);
      
      // Validate user
      const user = cachedTutors[empId];
      if (!user) {
        hideLoading();
        errorEl.textContent = 'Invalid Employee ID. Try: 16180339 (admin), 98765 (tutor)';
        errorEl.style.display = 'block';
        return;
      }
      
      currentUser = user;
      
      // Load students
      showProgressMessage('Loading students...');
      cachedStudents = await mockApiCall('students', 1000);
      showProgressMessage('‚úì Students loaded', true);
      
      // Load links
      showProgressMessage('Building link map...');
      cachedLinks = await mockApiCall('links', 700);
      showProgressMessage('‚úì Link map ready', true);
      
      // Update UI
      document.getElementById('userName').textContent = `${user.firstName} ${user.lastName}`;
      
      // Hide loading, show app
      await new Promise(resolve => setTimeout(resolve, 500));
      hideLoading();
      document.getElementById('loginOverlay').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      
      // Render student list (filtered by role)
      renderStudentList();
    }

    function logout() {
      currentUser = null;
      currentStudent = null;
      cachedTutors = {};
      cachedStudents = [];
      cachedLinks = [];
      apiRequests = [];
      
      document.getElementById('loginOverlay').style.display = 'flex';
      document.getElementById('app').style.display = 'none';
      document.getElementById('empIdInput').value = '';
      document.getElementById('loginError').style.display = 'none';
      document.getElementById('apiPanel').classList.remove('show');
      
      updateApiPanel();
    }

    /*
     * ==================== LOADING OVERLAY ====================
     * Penguin animation with progress messages
     */
    
    function showLoading() {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.add('show');
      document.getElementById('progressMessages').innerHTML = '';
    }
    
    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }
    
    function showProgressMessage(message, isComplete = false) {
      const container = document.getElementById('progressMessages');
      const messageEl = document.createElement('div');
      messageEl.className = 'progress-message' + (isComplete ? ' complete' : '');
      messageEl.textContent = message;
      container.appendChild(messageEl);
      
      // Keep only last 3 messages
      while (container.children.length > 3) {
        container.removeChild(container.firstChild);
      }
    }

    /*
     * ==================== STUDENT LIST ====================
     * Displays filtered student cards based on user role
     */
    
    function renderStudentList() {
      const listEl = document.getElementById('studentList');
      
      // Filter students based on role
      let students = cachedStudents;
      if (currentUser.role !== 'admin') {
        // Tutor: only show students they're linked to
        const myStudentIds = new Set(
          cachedLinks
            .filter(link => link.tutorId === currentUser.id && link.active)
            .map(link => link.studentId)
        );
        students = cachedStudents.filter(s => myStudentIds.has(s.id));
      }
      
      if (students.length === 0) {
        listEl.innerHTML = '<div class="empty-state">No students assigned to you yet.</div>';
        return;
      }

      listEl.innerHTML = students.map(s => {
        const initials = s.firstName[0] + s.lastName[0];
        return `
          <div class="student-card" onclick="openStudent('${s.id}')">
            <div class="student-avatar">${initials}</div>
            <div class="student-card-content">
              <div class="student-name">${escapeHtml(s.firstName)} ${escapeHtml(s.lastName)}</div>
              <div class="student-meta">Grade ${s.grade} ‚Ä¢ ${escapeHtml(s.school)}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function filterStudents() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const listEl = document.getElementById('studentList');
      
      let students = cachedStudents;
      if (currentUser.role !== 'admin') {
        const myStudentIds = new Set(
          cachedLinks
            .filter(link => link.tutorId === currentUser.id && link.active)
            .map(link => link.studentId)
        );
        students = cachedStudents.filter(s => myStudentIds.has(s.id));
      }

      const filtered = students.filter(s => 
        s.firstName.toLowerCase().includes(query) ||
        s.lastName.toLowerCase().includes(query) ||
        s.school.toLowerCase().includes(query)
      );

      if (filtered.length === 0) {
        listEl.innerHTML = '<div class="empty-state">No students found</div>';
        return;
      }

      listEl.innerHTML = filtered.map(s => {
        const initials = s.firstName[0] + s.lastName[0];
        return `
          <div class="student-card" onclick="openStudent('${s.id}')">
            <div class="student-avatar">${initials}</div>
            <div class="student-card-content">
              <div class="student-name">${escapeHtml(s.firstName)} ${escapeHtml(s.lastName)}</div>
              <div class="student-meta">Grade ${s.grade} ‚Ä¢ ${escapeHtml(s.school)}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    /*
     * ==================== STUDENT PROFILE ====================
     * Opens student profile with cached data (instant load)
     * Lazy loads tab-specific data on demand
     */
    
    async function openStudent(studentId) {
      currentStudent = cachedStudents.find(s => s.id === studentId);
      if (!currentStudent) return;

      // Switch views
      document.getElementById('listView').classList.add('hidden');
      document.getElementById('profileView').classList.remove('hidden');

      // Update header (cached data - instant!)
      document.getElementById('profileTitle').textContent = 
        `${currentStudent.firstName} ${currentStudent.lastName}`;
      document.getElementById('profileMeta').innerHTML = 
        `<strong>Grade:</strong> ${currentStudent.grade} ‚Ä¢ <strong>School:</strong> ${escapeHtml(currentStudent.school)}`;

      // Render Overview tab immediately (cached)
      renderOverview();
      
      // Reset other tabs
      document.getElementById('tutorsList').innerHTML = '';
      document.getElementById('contactEmail').textContent = '';
      document.getElementById('historyList').innerHTML = '';
      document.getElementById('commentsList').innerHTML = '';
      
      // Reset comments lazy load
      document.getElementById('loadCommentsBtn').classList.remove('hidden');
      document.getElementById('commentsCard').classList.add('hidden');
      
      // Reset history pagination
      historyOffset = 0;
      document.getElementById('loadMoreBtn').classList.add('hidden');

      switchTab('overview');
    }

    function showList() {
      currentStudent = null;
      document.getElementById('profileView').classList.add('hidden');
      document.getElementById('listView').classList.remove('hidden');
      document.getElementById('searchInput').value = '';
      renderStudentList();
    }

    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.tab === tabName) {
          btn.classList.add('active');
        }
      });

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // Lazy load data for specific tabs
      if (tabName === 'team' && document.getElementById('tutorsList').innerHTML === '') {
        renderTeam();
      }
      
      if (tabName === 'contact' && document.getElementById('contactEmail').textContent === '') {
        renderContact();
      }
      
      if (tabName === 'history' && document.getElementById('historyList').innerHTML === '') {
        renderHistory();
      }
    }

    /*
     * ==================== TAB RENDERERS ====================
     * Each tab has its own render function
     * Some use cached data (instant), others lazy load
     */
    
    function renderOverview() {
      // Bio and notes (cached - instant!)
      document.getElementById('studentBio').textContent = currentStudent.bio;
      
      const notesHtml = linkify(escapeHtml(currentStudent.notes));
      document.getElementById('studentNotes').innerHTML = notesHtml;
    }

    async function renderTeam() {
      // Lazy load: simulate fetching team data
      const listEl = document.getElementById('tutorsList');
      listEl.innerHTML = '<div style="color: #a0aec0; text-align: center; padding: 20px;">Loading team...</div>';
      
      // Find links for this student
      const studentLinks = cachedLinks.filter(link => 
        link.studentId === currentStudent.id && link.active
      );
      
      if (studentLinks.length === 0) {
        listEl.innerHTML = '<div class="empty-state">No tutors assigned</div>';
        return;
      }

      listEl.innerHTML = studentLinks.map(link => {
        const tutor = cachedTutors[link.tutorId];
        if (!tutor) return '';
        
        return `
          <div class="tutor-chip" onclick="openTutorModal('${tutor.id}')">
            <span class="tutor-name">${escapeHtml(tutor.firstName)} ${escapeHtml(tutor.lastName)}</span>
            <span class="tutor-subject">[${escapeHtml(link.subject)}]</span>
            <div class="tutor-tooltip">Last seen: ${link.lastSeen}</div>
          </div>
        `;
      }).join('');
    }

    async function renderContact() {
      // Lazy load: simulate fetching contact data
      document.getElementById('contactEmail').innerHTML = '<span style="color: #a0aec0;">Loading...</span>';
      
      await new Promise(resolve => setTimeout(resolve, 300));
      
      document.getElementById('contactEmail').innerHTML = 
        `<a href="mailto:${currentStudent.email}">${escapeHtml(currentStudent.email)}</a>`;
      document.getElementById('contactPhone').textContent = currentStudent.phone;
      document.getElementById('contactParent').textContent = currentStudent.parentName;
      document.getElementById('contactParentEmail').innerHTML = 
        `<a href="mailto:${currentStudent.parentEmail}">${escapeHtml(currentStudent.parentEmail)}</a>`;
      document.getElementById('contactParentPhone').textContent = currentStudent.parentPhone;
    }

    async function renderHistory() {
      // Lazy load: fetch session history
      const listEl = document.getElementById('historyList');
      listEl.innerHTML = '<div style="color: #a0aec0; text-align: center; padding: 20px;">Loading sessions...</div>';
      
      const allSessions = await mockApiCall('sessions', 600);
      const studentSessions = allSessions[currentStudent.id] || [];
      
      if (studentSessions.length === 0) {
        listEl.innerHTML = '<div class="empty-state">No session history yet</div>';
        return;
      }
      
      // Show first 3 sessions
      historyOffset = 0;
      displayHistorySessions(studentSessions);
    }
    
    function displayHistorySessions(allSessions) {
      const listEl = document.getElementById('historyList');
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      
      const sessionsToShow = allSessions.slice(0, historyOffset + HISTORY_PAGE_SIZE);
      
      listEl.innerHTML = sessionsToShow.map(session => {
        const tutor = cachedTutors[session.tutorId];
        return `
          <div class="history-item">
            <div class="history-date">${session.date}</div>
            <div class="history-subject">${escapeHtml(session.subject)} ‚Ä¢ ${session.duration}</div>
            <div class="history-tutor">with ${tutor ? escapeHtml(tutor.firstName + ' ' + tutor.lastName) : 'Unknown'}</div>
            ${session.notes ? `<div class="history-notes">${escapeHtml(session.notes)}</div>` : ''}
          </div>
        `;
      }).join('');
      
      // Show/hide "Load More" button
      if (sessionsToShow.length < allSessions.length) {
        loadMoreBtn.classList.remove('hidden');
      } else {
        loadMoreBtn.classList.add('hidden');
      }
    }
    
    async function loadMoreHistory() {
      const allSessions = await mockApiCall('sessions', 400);
      const studentSessions = allSessions[currentStudent.id] || [];
      
      historyOffset += HISTORY_PAGE_SIZE;
      displayHistorySessions(studentSessions);
    }

    async function loadComments() {
      // Lazy load: fetch comments
      document.getElementById('loadCommentsBtn').textContent = 'Loading comments...';
      
      const allComments = await mockApiCall('comments', 500);
      const studentComments = allComments[currentStudent.id] || [];
      
      document.getElementById('loadCommentsBtn').classList.add('hidden');
      document.getElementById('commentsCard').classList.remove('hidden');
      
      const listEl = document.getElementById('commentsList');
      
      if (studentComments.length === 0) {
        listEl.innerHTML = '<div class="empty-state">No comments yet</div>';
        return;
      }

      listEl.innerHTML = studentComments.map(comment => {
        const tutor = cachedTutors[comment.tutorId];
        const bodyHtml = linkify(escapeHtml(comment.body));
        const date = new Date(comment.timestamp).toLocaleString();
        
        return `
          <div class="comment">
            <div class="comment-header">
              <span class="comment-author" onclick="openTutorModal('${comment.tutorId}')">${tutor ? escapeHtml(tutor.firstName + ' ' + tutor.lastName) : 'Unknown'}</span>
              <span class="comment-date">${date}</span>
            </div>
            <div class="comment-body">${bodyHtml}</div>
          </div>
        `;
      }).join('');
    }

    /*
     * ==================== TUTOR MODAL ====================
     * Reusable dialog for tutor contact info
     */
    
    function openTutorModal(tutorId) {
      const tutor = cachedTutors[tutorId];
      if (!tutor) return;

      document.getElementById('tutorModalName').textContent = 
        `${tutor.firstName} ${tutor.lastName}`;
      document.getElementById('tutorModalEmail').innerHTML = 
        `<a href="mailto:${tutor.email}">${escapeHtml(tutor.email)}</a>`;
      document.getElementById('tutorModalMobile').textContent = tutor.phoneMobile;
      document.getElementById('tutorModalHome').textContent = tutor.phoneHome;
      
      // Get subjects from links if viewing a student, otherwise show all
      let subjects = 'N/A';
      if (currentStudent) {
        const links = cachedLinks.filter(l => 
          l.studentId === currentStudent.id && l.tutorId === tutorId && l.active
        );
        subjects = links.map(l => l.subject).join(', ') || 'N/A';
      } else if (tutor.subjects) {
        subjects = tutor.subjects.join(', ');
      }
      document.getElementById('tutorModalSubjects').textContent = subjects;

      document.getElementById('tutorModal').classList.add('show');
    }

    function closeTutorModal() {
      document.getElementById('tutorModal').classList.remove('show');
    }

    function closeModal(event) {
      if (event.target.classList.contains('modal-overlay')) {
        closeTutorModal();
      }
    }

    /*
     * ==================== UTILITIES ====================
     * Helper functions for escaping and linkifying text
     */
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function linkify(text) {
      // Linkify URLs
      text = text.replace(
        /(https?:\/\/[^\s]+)/g,
        '<a href="$1" target="_blank">$1</a>'
      );
      
      // Linkify emails
      text = text.replace(
        /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g,
        '<a href="mailto:$1">$1</a>'
      );
      
      return text;
    }
  </script>
</body>
</html>
